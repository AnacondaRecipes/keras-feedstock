{% set name = "keras" %}
{% set version = "3.0.5" %}

package:
  name: keras
  version: {{ version }}

source:
  url: https://github.com/keras-team/keras/archive/refs/tags/v{{ version }}.tar.gz
  sha256: 0e23205f2d8f434ded17ca9efb116cdb7b6d19736e576456c28aea685a7f195f

build:
  script_env:
    - KERAS_BACKEND=torch
  number: 0
  script:
    - {{ PYTHON }} -m pip install . --no-deps --ignore-installed --no-build-isolation -v
  # skipping s390x since dm-tree and jax are not available
  skip: true  # [py<39 or s390x]

requirements:
  build:
    - patch     # [not win]
    - m2-patch  # [win]
  host:
    - python
    - pip
    - wheel
    - setuptools
  run:
    - python
    - absl-py
    - numpy
    - rich
    - namex
    - h5py
    - ml_dtypes
    - packaging
    - dm-tree

  run_constrained:
    - tensorflow >=2.15.0,<2.17.0a
    - jax 0.4.*
    - pytorch >=2.1,<2.3

test:
  imports:
    - keras
    - keras.backend
    - keras.datasets
    - keras.layers
    - keras.utils
  requires:
    - pip
    - jax  # [not win]
    - pytorch
  commands:
    - pip check
    # numpy import jax in source code which causes test to fail for win
    - python -c "import os; os.environ['KERAS_BACKEND'] = 'numpy'; import keras;"  # [not win]
    - python -c "import os; os.environ['KERAS_BACKEND'] = 'jax'; import keras;"    # [not win]
    - python -c "import os; os.environ['KERAS_BACKEND'] = 'torch'; import keras;"

about:
  home: https://github.com/fchollet/keras
  license: MIT
  license_family: MIT
  license_file: LICENSE
  summary: Deep Learning for humans
  description: |
    Keras 3 is a multi-backend deep learning framework, with support for JAX, 
    TensorFlow, and PyTorch. Effortlessly build and train models for computer 
    vision, natural language processing, audio processing, timeseries forecasting, 
    recommender systems, etc.
  doc_url: https://keras.io/
  dev_url: https://github.com/fchollet/keras

extra:
  recipe-maintainers:
    - ericdill
    - mariusvniekerk
    - croth1
    - ocefpaf
    - jjhelmus
